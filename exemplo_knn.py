# -*- coding: utf-8 -*-
"""exemplo KNN

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1MXSCoUteXComfHLI1JR6Qv-ZpnQauTF0
"""

import pandas as pd
from sklearn.neighbors import NearestNeighbors
from sklearn.preprocessing import MultiLabelBinarizer, MinMaxScaler
import numpy as np

# Criar o banco de dados expandido
data = [
    {"id": 1, "titulo": "Matrix", "generos": ["A√ß√£o", "Fic√ß√£o Cient√≠fica"], "popularidade": 8.7},
    {"id": 2, "titulo": "Vingadores", "generos": ["A√ß√£o", "Aventura"], "popularidade": 8.0},
    {"id": 3, "titulo": "O Poderoso Chef√£o", "generos": ["Drama", "Crime"], "popularidade": 9.2},
    {"id": 4, "titulo": "Interestelar", "generos": ["Fic√ß√£o Cient√≠fica", "Drama"], "popularidade": 8.6},
    {"id": 5, "titulo": "Gladiador", "generos": ["A√ß√£o", "Drama"], "popularidade": 8.5},
    {"id": 6, "titulo": "Titanic", "generos": ["Romance", "Drama"], "popularidade": 7.9},
    {"id": 7, "titulo": "O Senhor dos An√©is", "generos": ["Fantasia", "Aventura"], "popularidade": 9.0},
    {"id": 8, "titulo": "Harry Potter", "generos": ["Fantasia", "Aventura"], "popularidade": 8.1},
    {"id": 9, "titulo": "Coringa", "generos": ["Drama", "Crime"], "popularidade": 8.4},
    {"id": 10, "titulo": "Deadpool", "generos": ["A√ß√£o", "Com√©dia"], "popularidade": 8.0},
    {"id": 11, "titulo": "Logan", "generos": ["A√ß√£o", "Drama"], "popularidade": 8.2},
    {"id": 12, "titulo": "Pantera Negra", "generos": ["A√ß√£o", "Fic√ß√£o Cient√≠fica"], "popularidade": 7.8},
    {"id": 13, "titulo": "Django Livre", "generos": ["Faroeste", "Drama"], "popularidade": 8.4},
    {"id": 14, "titulo": "O Lobo de Wall Street", "generos": ["Com√©dia", "Crime"], "popularidade": 8.2},
    {"id": 15, "titulo": "Clube da Luta", "generos": ["Drama", "Suspense"], "popularidade": 8.8},
    {"id": 16, "titulo": "Star Wars: Uma Nova Esperan√ßa", "generos": ["Fic√ß√£o Cient√≠fica", "Aventura"], "popularidade": 8.6},
    {"id": 17, "titulo": "Velozes e Furiosos", "generos": ["A√ß√£o", "Crime"], "popularidade": 7.2},
    {"id": 18, "titulo": "It: A Coisa", "generos": ["Terror", "Suspense"], "popularidade": 7.5},
    {"id": 19, "titulo": "Invoca√ß√£o do Mal", "generos": ["Terror", "Suspense"], "popularidade": 7.9},
    {"id": 20, "titulo": "Toy Story", "generos": ["Anima√ß√£o", "Aventura"], "popularidade": 8.3},
    {"id": 21, "titulo": "Shrek", "generos": ["Anima√ß√£o", "Com√©dia"], "popularidade": 8.0},
    {"id": 22, "titulo": "Divertida Mente", "generos": ["Anima√ß√£o", "Fam√≠lia"], "popularidade": 8.1},
    {"id": 23, "titulo": "Frozen", "generos": ["Anima√ß√£o", "Fantasia"], "popularidade": 7.4},
    {"id": 24, "titulo": "Procurando Nemo", "generos": ["Anima√ß√£o", "Aventura"], "popularidade": 8.2},
    {"id": 25, "titulo": "Mad Max: Estrada da F√∫ria", "generos": ["A√ß√£o", "Fic√ß√£o Cient√≠fica"], "popularidade": 8.1}
]

df = pd.DataFrame(data)

# Converter g√™neros em vari√°veis bin√°rias (one-hot encoding)
mlb = MultiLabelBinarizer()
generos_encoded = mlb.fit_transform(df["generos"])
generos_df = pd.DataFrame(generos_encoded, columns=mlb.classes_)

# Normalizar a popularidade para ficar entre 0 e 1
scaler = MinMaxScaler()
df["popularidade_norm"] = scaler.fit_transform(df[["popularidade"]])

# Criar o dataset final para o KNN (juntando g√™neros e popularidade)
X = pd.concat([generos_df, df[["popularidade_norm"]]], axis=1)

# Treinar o modelo KNN
knn = NearestNeighbors(n_neighbors=3, metric="euclidean")
knn.fit(X)

# Fun√ß√£o para recomendar filmes com base em entrada do usu√°rio
def recomendar_filmes_knn(preferencias_usuario, popularidade_usuario, num_recomendacoes=3):
    # Ajustar entrada do usu√°rio: remover espa√ßos extras e padronizar para mai√∫sculas/min√∫sculas corretas
    preferencias_usuario = [g.strip().capitalize() for g in preferencias_usuario]

    # Criar vetor de entrada do usu√°rio
    genero_usuario = [1 if g in preferencias_usuario else 0 for g in mlb.classes_]
    popularidade_usuario_norm = scaler.transform([[popularidade_usuario]])[0][0]
    entrada_usuario = np.array(genero_usuario + [popularidade_usuario_norm]).reshape(1, -1)

    # Encontrar os filmes mais pr√≥ximos
    distancias, indices = knn.kneighbors(entrada_usuario, n_neighbors=num_recomendacoes)

    # Retornar os filmes recomendados
    recomendacoes = df.iloc[indices[0]][["titulo", "generos", "popularidade"]]
    return recomendacoes

# Entrada do usu√°rio
entrada_generos = input("Op√ß√£o de g√™neros:\n"
                        "A√ß√£o\n"
                        "Anima√ß√£o\n"
                        "Aventura\n"
                        "Com√©dia\n"
                        "Crime\n"
                        "Drama\n"
                        "Fantasia\n"
                        "Fam√≠lia\n"
                        "Faroeste\n"
                        "Fic√ß√£o Cient√≠fica\n"
                        "Romance\n"
                        "Suspense\n"
                        "Terror\n"
                        "Digite os g√™neros desejados separados por v√≠rgula (ex: a√ß√£o, drama): ")
entrada_popularidade = float(input("Digite a popularidade desejada (ex: 8.0): "))

# Processar entrada do usu√°rio
preferencias_usuario = entrada_generos.split(",")

# Recomendar filmes
print("\nüé¨ Filmes recomendados:")
print(recomendar_filmes_knn(preferencias_usuario, entrada_popularidade))